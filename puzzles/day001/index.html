<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Daily Cryptojoke</title>

<style>
  :root {
    --teal: #008080;
    --teal-dark:#006a6a;
    --gold: #d8c178;
    --light-bg: #f5f6f7;
    --panel:#ffffff;
    --muted:#6b6b6b;
    --line:#b9b9b9;
  }

  body{
    margin:0;
    background:var(--light-bg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:#1e1e1e;
  }

  /* Teal header bar to match other puzzles */
  header{
    background:var(--teal);
    color:#fff;
    padding:14px 8px;
    text-align:center;
    border-bottom:3px solid var(--teal-dark);
  }
  header h1{
    margin:0;
    font-size:22px;
    letter-spacing:.4px;
  }
  header h2{
    margin:4px 0 0;
    font-size:15px;
    font-weight:600;
  }

  .wrap{
    max-width:580px;
    margin:10px auto;
    padding:10px;
    box-sizing:border-box;
  }

  .puzzle-container {
    width: 100%;
    background: var(--panel);
    border: 1px solid #ddd;
    border-radius: 16px;
    padding: 1em 0.8em;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    box-sizing: border-box;
  }

  h3 {
    text-align: center;
    color: var(--teal);
    font-size: clamp(1.1em, 4vw, 1.4em);
    margin-top: 0;
    margin-bottom: 0.4em;
  }

  .instructions {
    text-align: center;
    font-style: italic;
    color: var(--muted);
    margin-bottom: 0.8em;
    font-size: clamp(0.85em, 3.2vw, 0.95em);
  }

  #cryptogram {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px 6px;
    font-family: monospace;
    font-size: clamp(15px, 3.6vw, 18px);
    line-height: 1.5;
    margin-bottom: 1.2em;
    overflow: visible;
    padding: 0 0.4em;
  }

  .word {
    display: inline-flex;
    flex-wrap: nowrap;
    align-items: flex-end;
    margin-right: 8px;
    transition: transform 0.2s ease;
    transform-origin: left center;
  }

  input[type=text] {
    width: clamp(30px, 7vw, 40px);
    height: clamp(30px, 7vw, 40px);
    font-size: clamp(14px, 3.5vw, 18px);
    text-align: center;
    text-transform: uppercase;
    border: 1.3px solid #ccc;
    border-radius: 6px;
    padding: 0;
    flex-shrink: 0;
    transition: border 0.2s ease, background 0.2s ease;
    box-sizing: border-box;
  }

  input[type=text]:focus {
    outline: none;
    border: 1.3px solid var(--teal);
    background: #e8f8fb;
  }

  .button-row {
    text-align: center;
    margin-top: 0.5em;
  }

  /* Clear button styled to match Word Search/Sudoku */
  .btn {
    padding: 9px 14px;
    margin: 5px;
    border-radius: 10px;
    background: #fff;
    color: var(--teal);
    border: 1px solid var(--teal);
    cursor: pointer;
    font-family: inherit;
    font-size: clamp(14px, 3.2vw, 15px);
    font-weight: 700;
    transition: background 0.2s ease, transform 0.1s ease;
  }

  .btn:active {
    background: var(--gold);
    color: #000;
    transform: scale(0.97);
  }

  @media (max-width: 480px) {
    #cryptogram { gap: 8px 5px; }
    .puzzle-container { padding: 0.8em; }
  }
</style>
</head>

<body>

<header>
  <h1>Daily Cryptojoke</h1>
  <h2>{{DAY_LABEL}}</h2>
</header>

<div class="wrap">
  <div class="puzzle-container" role="main" aria-label="Cryptogram puzzle">
    <h3>Can you crack todayâ€™s joke?</h3>
    <p class="instructions">Type your guesses under each letter. Your progress is saved automatically.</p>

    <div id="cryptogram" aria-live="polite"></div>

    <div class="button-row">
      <button id="clearBtn" class="btn" aria-label="Clear my answers">Clear My Answers</button>
    </div>
  </div>
</div>

<script>
(function(){
  // Encrypted phrase (UPPERCASE). Edit this per puzzle.
  const phrase = "FSW ROR DST CZQNTZNLF FOH QH QFQNR? MTZQACT ST FQC LADCDQHROHP OH SOC YOTIR.";

  const container = document.getElementById("cryptogram");
  const clearBtn = document.getElementById("clearBtn");

  // Change this per day so auto-save is unique:
  const STORAGE_KEY = "cryptojoke_day_XXX";
  const CLEAR_FLAG = "cryptojoke-cleared";

  function setCookie(name, value, days) {
    const d = new Date();
    d.setTime(d.getTime() + (days*24*60*60*1000));
    document.cookie = `${name}=${encodeURIComponent(value)};expires=${d.toUTCString()};path=/`;
  }
  function getCookie(name) {
    const m = document.cookie.match(new RegExp('(^|; )'+name+'=([^;]*)'));
    return m ? decodeURIComponent(m[2]) : "";
  }

  const isCleared = getCookie(CLEAR_FLAG) === "true";
  let saved = {};
  try {
    if (!isCleared) {
      saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
    }
  } catch(e){ saved = {}; }

  const inputs = [];

  // Build the cryptogram display
  phrase.split(" ").forEach((word, wIndex) => {
    const wordDiv = document.createElement("div");
    wordDiv.classList.add("word");

    word.split("").forEach((ch, cIndex) => {
      if (/[A-Z]/.test(ch)) {
        const cell = document.createElement("div");
        cell.style.display = "flex";
        cell.style.flexDirection = "column";
        cell.style.alignItems = "center";

        const top = document.createElement("div");
        top.textContent = ch;
        top.style.fontWeight = "700";
        top.style.marginBottom = "4px";
        top.style.color = "var(--teal)";
        top.style.fontSize = "clamp(14px, 3.3vw, 17px)";

        const box = document.createElement("input");
        box.type = "text";
        box.maxLength = 1;
        const id = `${wIndex}-${cIndex}`;
        if (saved[id]) box.value = saved[id];

        box.addEventListener("input", (e) => {
          e.target.value = e.target.value.toUpperCase().replace(/[^A-Z]/g,"").slice(0,1);
          if (e.target.value) saved[id] = e.target.value;
          else delete saved[id];
          localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
          setCookie(CLEAR_FLAG, "false", 7);
        });

        cell.appendChild(top);
        cell.appendChild(box);
        wordDiv.appendChild(cell);
        inputs.push({ id, box });
      } else {
        const punct = document.createElement("div");
        punct.textContent = ch;
        punct.style.marginLeft = "6px";
        punct.style.fontWeight = "700";
        punct.style.color = "var(--teal)";
        wordDiv.appendChild(punct);
      }
    });

    container.appendChild(wordDiv);
  });

  // Clear button
  clearBtn.addEventListener("click", () => {
    inputs.forEach(({ box }) => box.value = "");
    localStorage.removeItem(STORAGE_KEY);
    setCookie(CLEAR_FLAG, "true", 7);
  });

  // Optional: fit long words slightly to avoid overflow
  function fitLongestWord() {
    const words = container.querySelectorAll(".word");
    const parentWidth = container.clientWidth || window.innerWidth;
    words.forEach(w => {
      w.style.transform = "scale(1)";
      const rect = w.getBoundingClientRect();
      const scale = rect.width > parentWidth ? parentWidth / rect.width - 0.05 : 1;
      if (scale < 1) w.style.transform = `scale(${scale})`;
    });
  }

  window.addEventListener("resize", () => setTimeout(fitLongestWord, 80));
  window.addEventListener("load", () => setTimeout(fitLongestWord, 80));
  setTimeout(fitLongestWord, 200);
})();
</script>

</body>
</html>
